knitr::opts_chunk$set(echo = TRUE)
### Hey guys, lets use APA citation again. save any references in a bib
#in-text citation is [@key] for example [@alberta_wildfire_dataset]
#put imported libraries here
library(tidyverse)
library(mosaic)
#read in wildfire csv file
url <- "https://raw.githubusercontent.com/JohannaEnright/Wildfire_602_Project/refs/heads/main/fp-historical-wildfire-data-2006-2024.csv"
df = read_csv(url, show_col_types = F)
####### determining proportion for lightning caused fires in 2006 and 2024  #######
#2006
df_2006 <- df %>%  filter(YEAR == 2006)
n_2006 <- nrow(df_2006)
x_2006 <- df_2006 %>% filter(GENERAL_CAUSE == "Lightning") %>% nrow()  #number from 2006 caused by lightning
p_lightning_2006 <- x_2006/n_2006
#2024
df_2024 <- df %>%  filter(YEAR == 2024)
n_2024 <- nrow(df_2024)
x_2024 <- df_2024 %>% filter(GENERAL_CAUSE == "Lightning") %>% nrow() #x is number of fires caused by lightning
p_lightning_2024 <- x_2024/n_2024
print(paste("The 2006 proportion is", round(p_lightning_2006,4) ," and the 2024 proportion is", round(p_lightning_2024,4)))
## confirming it follows assumtions (np > 10) , (nq > 10)   # is sufficiently large.
n_2006*p_lightning_2006 >10 ; n_2006*(1 - p_lightning_2006) > 10 ## greater than 10
n_2024*p_lightning_2024 > 10 ; n_2024*(1 - p_lightning_2024) > 10
#############################  CALCULATING Z-observed ####################################
# Zobs = ((phat1 - phat2) - (p1 - p2)) / sqrt(phat*(1-phat)*(1/n1 + 1/n2))
phat <- (x_2006 + x_2024)/(n_2006 + n_2024)
p1_min_p2 <- 0   #under the assumption of the null hypothesis
Zobs <- ((p_lightning_2024 - p_lightning_2006) - p1_min_p2)/sqrt(phat*(1-phat)*(1/n_2024 + 1/n_2006))
pvalue <- round(1 - pnorm(Zobs),5)
print(paste("The test statistic is:", round(Zobs,4), "The p-value is:", pvalue))
#set up dataframe
x <- seq(-5, 5,0.001)
df_norm <- tibble(x = x, y = dnorm(x, mean = 0, sd = 1))
#labels for lines
labels_df <- tibble(x = c(qnorm(0.95), Zobs), y = 0.21,
label = c(bquote(Z[0.05] == .(round(qnorm(0.95),2))), bquote(Z["obs"] == .(round(Zobs,2)))) )
p <- df_norm %>%
ggplot(aes(x = x, y = y)) +
geom_line(linewidth = 1)+
geom_segment(aes(x = qnorm(0.95), xend = qnorm(0.95), y = 0, yend = 0.2),
linewidth = 1, color = "black") +
geom_segment(aes(x = Zobs, xend = Zobs, y = 0, yend = 0.2),
linewidth = 1, color = "black") +
geom_text(data = labels_df, aes(x = x, y = y, label = label), vjust = 0, hjust = 0, color = "black", parse=TRUE) +
#shade in areas
geom_area(data = subset(df_norm, x > qnorm(0.95)), aes(x = x, y = y), fill = "red", alpha = 0.3) +   # shade passed critical value
geom_area(data = subset(df_norm, x > Zobs), aes(x = x, y = y), fill = "blue", alpha = 1) +     #shade passed Zobs
annotate(geom = "text", x = 5, y = 0.02, label = paste("p=", pvalue), size = 3, hjust = 1) +
ggtitle(bquote("Right-Tailed Test for Lightning-Caused Wildfire Proportions H"[A] * ": p"[2024] > "p"[2006]),
subtitle = "Standard Normal Curve") +
theme_minimal()
print(p)
################## USING THE AGRESTI-COULL (+1/+2 METHOD) 95% CI ################################
# (ptilde1 - ptilde2) +/-  (z (1 - alpha/2)) * sqrt((ptilde1*qtilde1/(n1 + 2)) + (ptilde2*qtilde2)/(n2 + 2))
#p_tilde = (x + 1)/ (n + 2)
p_tilde_2024 <- (x_2024 + 1)/(n_2024 + 2)
p_tilde_2006 <- (x_2006 + 1)/(n_2006 + 2)
ptilde_diff <- p_tilde_2024 - p_tilde_2006
z <- qnorm(1 - 0.05/2)
SE <- sqrt(((p_tilde_2024)*(1-p_tilde_2024)/(n_2024 + 2)) +
((p_tilde_2006)*(1-p_tilde_2006)/(n_2006 + 2))
)
lb <- ptilde_diff - z * SE
ub <- ptilde_diff + z * SE
paste(round(lb, 4), "-", round(ub, 4))
# CONCLUSION : 2024 HAS A SIGNIFICANTLY HIGHER PROPORITON OF LIGHTNING-CAUSED WILDFIRES THAT 2006
# Visualization
plot_df <- tibble(
YEAR  = factor(c(2006, 2024, "Difference")),
prop  = c(p_lightning_2006, p_lightning_2024, p_lightning_2024-p_lightning_2006),
lower = c(NA, NA, lb),
upper = c(NA, NA, ub),
n     = c(n_2006, n_2024, NA),
x     = c(x_2006, x_2024, NA)
)
ggplot(plot_df, aes(x = YEAR, y = prop, fill = YEAR)) +
geom_col(width = 0.5, show.legend = FALSE) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.15, linewidth = 0.8) +
geom_text(aes(label = ifelse(YEAR %in% c(2006, 2024), paste0("n=", n, "\nx=", x), NA)),
vjust = -0.9, size = 3.5) +
scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
labs(
title = "Proportion of Lightning-caused Wildfires (AC 95% CI)",
x = "Year",
y = "Proportion (Lightning)"
) +
theme_minimal(base_size = 12)
knitr::opts_chunk$set(echo = TRUE)
### Hey guys, lets use APA citation again. save any references in a bib
#in-text citation is [@key] for example [@alberta_wildfire_dataset]
#put imported libraries here
library(tidyverse)
library(mosaic)
#read in wildfire csv file
url <- "https://raw.githubusercontent.com/JohannaEnright/Wildfire_602_Project/refs/heads/main/fp-historical-wildfire-data-2006-2024.csv"
df = read_csv(url, show_col_types = F)
####### determining proportion for lightning caused fires in 2006 and 2024  #######
#2006
df_2006 <- df %>%  filter(YEAR == 2006)
n_2006 <- nrow(df_2006)
x_2006 <- df_2006 %>% filter(GENERAL_CAUSE == "Lightning") %>% nrow()  #number from 2006 caused by lightning
p_lightning_2006 <- x_2006/n_2006
#2024
df_2024 <- df %>%  filter(YEAR == 2024)
n_2024 <- nrow(df_2024)
x_2024 <- df_2024 %>% filter(GENERAL_CAUSE == "Lightning") %>% nrow() #x is number of fires caused by lightning
p_lightning_2024 <- x_2024/n_2024
print(paste("The 2006 proportion is", round(p_lightning_2006,4) ," and the 2024 proportion is", round(p_lightning_2024,4)))
## confirming it follows assumtions (np > 10) , (nq > 10)   # is sufficiently large.
n_2006*p_lightning_2006 >10 ; n_2006*(1 - p_lightning_2006) > 10 ## greater than 10
n_2024*p_lightning_2024 > 10 ; n_2024*(1 - p_lightning_2024) > 10
#############################  CALCULATING Z-observed ####################################
# Zobs = ((phat1 - phat2) - (p1 - p2)) / sqrt(phat*(1-phat)*(1/n1 + 1/n2))
phat <- (x_2006 + x_2024)/(n_2006 + n_2024)
p1_min_p2 <- 0   #under the assumption of the null hypothesis
Zobs <- ((p_lightning_2024 - p_lightning_2006) - p1_min_p2)/sqrt(phat*(1-phat)*(1/n_2024 + 1/n_2006))
pvalue <- round(1 - pnorm(Zobs),5)
print(paste("The test statistic is:", round(Zobs,4), "The p-value is:", pvalue))
#set up dataframe
x <- seq(-5, 5,0.001)
df_norm <- tibble(x = x, y = dnorm(x, mean = 0, sd = 1))
#labels for lines
labels_df <- tibble(x = c(qnorm(0.95), Zobs), y = 0.21,
label = c(bquote(Z[0.05] == .(round(qnorm(0.95),2))), bquote(Z["obs"] == .(round(Zobs,2)))) )
p <- df_norm %>%
ggplot(aes(x = x, y = y)) +
geom_line(linewidth = 1)+
geom_segment(aes(x = qnorm(0.95), xend = qnorm(0.95), y = 0, yend = 0.2),
linewidth = 1, color = "black") +
geom_segment(aes(x = Zobs, xend = Zobs, y = 0, yend = 0.2),
linewidth = 1, color = "black") +
geom_text(data = labels_df, aes(x = x, y = y, label = label), vjust = 0, hjust = 0, color = "black", parse=TRUE) +
#shade in areas
geom_area(data = subset(df_norm, x > qnorm(0.95)), aes(x = x, y = y), fill = "red", alpha = 0.3) +   # shade passed critical value
geom_area(data = subset(df_norm, x > Zobs), aes(x = x, y = y), fill = "blue", alpha = 1) +     #shade passed Zobs
annotate(geom = "text", x = 5, y = 0.02, label = paste("p=", pvalue), size = 3, hjust = 1) +
ggtitle(bquote("Right-Tailed Test for Lightning-Caused Wildfire Proportions H"[A] * ": p"[2024] > "p"[2006]),
subtitle = "Standard Normal Curve") +
theme_minimal()
print(p)
################## USING THE AGRESTI-COULL (+1/+2 METHOD) 95% CI ################################
# (ptilde1 - ptilde2) +/-  (z (1 - alpha/2)) * sqrt((ptilde1*qtilde1/(n1 + 2)) + (ptilde2*qtilde2)/(n2 + 2))
#p_tilde = (x + 1)/ (n + 2)
p_tilde_2024 <- (x_2024 + 1)/(n_2024 + 2)
p_tilde_2006 <- (x_2006 + 1)/(n_2006 + 2)
ptilde_diff <- p_tilde_2024 - p_tilde_2006
z <- qnorm(1 - 0.05/2)
SE <- sqrt(((p_tilde_2024)*(1-p_tilde_2024)/(n_2024 + 2)) +
((p_tilde_2006)*(1-p_tilde_2006)/(n_2006 + 2))
)
lb <- ptilde_diff - z * SE
ub <- ptilde_diff + z * SE
paste(round(lb, 4), "-", round(ub, 4))
# CONCLUSION : 2024 HAS A SIGNIFICANTLY HIGHER PROPORITON OF LIGHTNING-CAUSED WILDFIRES THAT 2006
# Visualization
plot_df <- tibble(
YEAR  = factor(c(2006, 2024, "Difference")),
prop  = c(p_lightning_2006, p_lightning_2024, p_lightning_2024-p_lightning_2006),
lower = c(NA, NA, lb),
upper = c(NA, NA, ub),
n     = c(n_2006, n_2024, NA),
x     = c(x_2006, x_2024, NA)
)
ggplot(plot_df, aes(x = YEAR, y = prop, fill = YEAR)) +
geom_col(width = 0.5, show.legend = FALSE) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.15, linewidth = 0.8) +
geom_text(aes(label = ifelse(YEAR %in% c(2006, 2024), paste0("n=", n, "\nx=", x), NA)),
vjust = -0.9, size = 3.5) +
scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
labs(
title = "Proportion of Lightning-caused Wildfires (AC 95% CI)",
x = "Year",
y = "Proportion (Lightning)"
) +
theme_minimal(base_size = 12)
knitr::opts_chunk$set(echo = TRUE)
### Hey guys, lets use APA citation again. save any references in a bib
#in-text citation is [@key] for example [@alberta_wildfire_dataset]
#put imported libraries here
library(tidyverse)
library(mosaic)
#read in wildfire csv file
url <- "https://raw.githubusercontent.com/JohannaEnright/Wildfire_602_Project/refs/heads/main/fp-historical-wildfire-data-2006-2024.csv"
df = read_csv(url, show_col_types = F)
####### determining proportion for lightning caused fires in 2006 and 2024  #######
#2006
df_2006 <- df %>%  filter(YEAR == 2006)
n_2006 <- nrow(df_2006)
x_2006 <- df_2006 %>% filter(GENERAL_CAUSE == "Lightning") %>% nrow()  #number from 2006 caused by lightning
p_lightning_2006 <- x_2006/n_2006
#2024
df_2024 <- df %>%  filter(YEAR == 2024)
n_2024 <- nrow(df_2024)
x_2024 <- df_2024 %>% filter(GENERAL_CAUSE == "Lightning") %>% nrow() #x is number of fires caused by lightning
p_lightning_2024 <- x_2024/n_2024
print(paste("The 2006 proportion is", round(p_lightning_2006,4) ," and the 2024 proportion is", round(p_lightning_2024,4)))
## confirming it follows assumtions (np > 10) , (nq > 10)   # is sufficiently large.
n_2006*p_lightning_2006 >10 ; n_2006*(1 - p_lightning_2006) > 10 ## greater than 10
n_2024*p_lightning_2024 > 10 ; n_2024*(1 - p_lightning_2024) > 10
#############################  CALCULATING Z-observed ####################################
# Zobs = ((phat1 - phat2) - (p1 - p2)) / sqrt(phat*(1-phat)*(1/n1 + 1/n2))
phat <- (x_2006 + x_2024)/(n_2006 + n_2024)
p1_min_p2 <- 0   #under the assumption of the null hypothesis
Zobs <- ((p_lightning_2024 - p_lightning_2006) - p1_min_p2)/sqrt(phat*(1-phat)*(1/n_2024 + 1/n_2006))
pvalue <- round(1 - pnorm(Zobs),5)
print(paste("The test statistic is:", round(Zobs,4), "The p-value is:", pvalue))
#set up dataframe
x <- seq(-5, 5,0.001)
df_norm <- tibble(x = x, y = dnorm(x, mean = 0, sd = 1))
#labels for lines
labels_df <- tibble(x = c(qnorm(0.95), Zobs), y = 0.21,
label = c(bquote(Z[0.05] == .(round(qnorm(0.95),2))), bquote(Z["obs"] == .(round(Zobs,2)))) )
p <- df_norm %>%
ggplot(aes(x = x, y = y)) +
geom_line(linewidth = 1)+
geom_segment(aes(x = qnorm(0.95), xend = qnorm(0.95), y = 0, yend = 0.2),
linewidth = 1, color = "black") +
geom_segment(aes(x = Zobs, xend = Zobs, y = 0, yend = 0.2),
linewidth = 1, color = "black") +
geom_text(data = labels_df, aes(x = x, y = y, label = label), vjust = 0, hjust = 0, color = "black", parse=TRUE) +
#shade in areas
geom_area(data = subset(df_norm, x > qnorm(0.95)), aes(x = x, y = y), fill = "red", alpha = 0.3) +   # shade passed critical value
geom_area(data = subset(df_norm, x > Zobs), aes(x = x, y = y), fill = "blue", alpha = 1) +     #shade passed Zobs
annotate(geom = "text", x = 5, y = 0.02, label = paste("p=", pvalue), size = 3, hjust = 1) +
ggtitle(bquote("Right-Tailed Test for Lightning-Caused Wildfire Proportions H"[A] * ": p"[2024] > "p"[2006]),
subtitle = "Standard Normal Curve") +
theme_minimal()
print(p)
################## USING THE AGRESTI-COULL (+1/+2 METHOD) 95% CI ################################
# (ptilde1 - ptilde2) +/-  (z (1 - alpha/2)) * sqrt((ptilde1*qtilde1/(n1 + 2)) + (ptilde2*qtilde2)/(n2 + 2))
#p_tilde = (x + 1)/ (n + 2)
p_tilde_2024 <- (x_2024 + 1)/(n_2024 + 2)
p_tilde_2006 <- (x_2006 + 1)/(n_2006 + 2)
ptilde_diff <- p_tilde_2024 - p_tilde_2006
z <- qnorm(1 - 0.05/2)
SE <- sqrt(((p_tilde_2024)*(1-p_tilde_2024)/(n_2024 + 2)) +
((p_tilde_2006)*(1-p_tilde_2006)/(n_2006 + 2))
)
lb <- ptilde_diff - z * SE
ub <- ptilde_diff + z * SE
paste(round(lb, 4), "-", round(ub, 4))
# CONCLUSION : 2024 HAS A SIGNIFICANTLY HIGHER PROPORITON OF LIGHTNING-CAUSED WILDFIRES THAT 2006
# Visualization
plot_df <- tibble(
YEAR  = factor(c(2006, 2024, "Difference")),
prop  = c(p_lightning_2006, p_lightning_2024, p_lightning_2024-p_lightning_2006),
lower = c(NA, NA, lb),
upper = c(NA, NA, ub),
n     = c(n_2006, n_2024, NA),
x     = c(x_2006, x_2024, NA)
)
ggplot(plot_df, aes(x = YEAR, y = prop, fill = YEAR)) +
geom_col(width = 0.5, show.legend = FALSE) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.15, linewidth = 0.8) +
geom_text(aes(label = ifelse(YEAR %in% c(2006, 2024), paste0("n=", n, "\nx=", x), NA)),
vjust = -0.9, size = 3.5) +
scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
labs(
title = "Proportion of Lightning-caused Wildfires (AC 95% CI)",
x = "Year",
y = "Proportion (Lightning)"
) +
theme_minimal(base_size = 12)
knitr::opts_chunk$set(echo = TRUE)
### Hey guys, lets use APA citation again. save any references in a bib
#in-text citation is [@key] for example [@alberta_wildfire_dataset]
#put imported libraries here
library(tidyverse)
library(mosaic)
#read in wildfire csv file
url <- "https://raw.githubusercontent.com/JohannaEnright/Wildfire_602_Project/refs/heads/main/fp-historical-wildfire-data-2006-2024.csv"
df = read_csv(url, show_col_types = F)
####### determining proportion for lightning caused fires in 2006 and 2024  #######
#2006
df_2006 <- df %>%  filter(YEAR == 2006)
n_2006 <- nrow(df_2006)
x_2006 <- df_2006 %>% filter(GENERAL_CAUSE == "Lightning") %>% nrow()  #number from 2006 caused by lightning
p_lightning_2006 <- x_2006/n_2006
#2024
df_2024 <- df %>%  filter(YEAR == 2024)
n_2024 <- nrow(df_2024)
x_2024 <- df_2024 %>% filter(GENERAL_CAUSE == "Lightning") %>% nrow() #x is number of fires caused by lightning
p_lightning_2024 <- x_2024/n_2024
print(paste("The 2006 proportion is", round(p_lightning_2006,4) ," and the 2024 proportion is", round(p_lightning_2024,4)))
## confirming it follows assumtions (np > 10) , (nq > 10)   # is sufficiently large.
n_2006*p_lightning_2006 >10 ; n_2006*(1 - p_lightning_2006) > 10 ## greater than 10
n_2024*p_lightning_2024 > 10 ; n_2024*(1 - p_lightning_2024) > 10
#############################  CALCULATING Z-observed ####################################
# Zobs = ((phat1 - phat2) - (p1 - p2)) / sqrt(phat*(1-phat)*(1/n1 + 1/n2))
phat <- (x_2006 + x_2024)/(n_2006 + n_2024)
p1_min_p2 <- 0   #under the assumption of the null hypothesis
Zobs <- ((p_lightning_2024 - p_lightning_2006) - p1_min_p2)/sqrt(phat*(1-phat)*(1/n_2024 + 1/n_2006))
pvalue <- round(1 - pnorm(Zobs),5)
print(paste("The test statistic is:", round(Zobs,4), "The p-value is:", pvalue))
#set up dataframe
x <- seq(-5, 5,0.001)
df_norm <- tibble(x = x, y = dnorm(x, mean = 0, sd = 1))
#labels for lines
labels_df <- tibble(x = c(qnorm(0.95), Zobs), y = 0.21,
label = c(bquote(Z[0.05] == .(round(qnorm(0.95),2))), bquote(Z["obs"] == .(round(Zobs,2)))) )
p <- df_norm %>%
ggplot(aes(x = x, y = y)) +
geom_line(linewidth = 1)+
geom_segment(aes(x = qnorm(0.95), xend = qnorm(0.95), y = 0, yend = 0.2),
linewidth = 1, color = "black") +
geom_segment(aes(x = Zobs, xend = Zobs, y = 0, yend = 0.2),
linewidth = 1, color = "black") +
geom_text(data = labels_df, aes(x = x, y = y, label = label), vjust = 0, hjust = 0, color = "black", parse=TRUE) +
#shade in areas
geom_area(data = subset(df_norm, x > qnorm(0.95)), aes(x = x, y = y), fill = "red", alpha = 0.3) +   # shade passed critical value
geom_area(data = subset(df_norm, x > Zobs), aes(x = x, y = y), fill = "blue", alpha = 1) +     #shade passed Zobs
annotate(geom = "text", x = 5, y = 0.02, label = paste("p=", pvalue), size = 3, hjust = 1) +
ggtitle(bquote("Right-Tailed Test for Lightning-Caused Wildfire Proportions H"[A] * ": p"[2024] > "p"[2006]),
subtitle = "Standard Normal Curve") +
theme_minimal()
print(p)
################## USING THE AGRESTI-COULL (+1/+2 METHOD) 95% CI ################################
# (ptilde1 - ptilde2) +/-  (z (1 - alpha/2)) * sqrt((ptilde1*qtilde1/(n1 + 2)) + (ptilde2*qtilde2)/(n2 + 2))
#p_tilde = (x + 1)/ (n + 2)
p_tilde_2024 <- (x_2024 + 1)/(n_2024 + 2)
p_tilde_2006 <- (x_2006 + 1)/(n_2006 + 2)
ptilde_diff <- p_tilde_2024 - p_tilde_2006
z <- qnorm(1 - 0.05/2)
SE <- sqrt(((p_tilde_2024)*(1-p_tilde_2024)/(n_2024 + 2)) +
((p_tilde_2006)*(1-p_tilde_2006)/(n_2006 + 2))
)
lb <- ptilde_diff - z * SE
ub <- ptilde_diff + z * SE
paste(round(lb, 4), "-", round(ub, 4))
# CONCLUSION : 2024 HAS A SIGNIFICANTLY HIGHER PROPORITON OF LIGHTNING-CAUSED WILDFIRES THAT 2006
# Visualization
plot_df <- tibble(
YEAR  = factor(c(2006, 2024, "Difference")),
prop  = c(p_lightning_2006, p_lightning_2024, p_lightning_2024-p_lightning_2006),
lower = c(NA, NA, lb),
upper = c(NA, NA, ub),
n     = c(n_2006, n_2024, NA),
x     = c(x_2006, x_2024, NA)
)
ggplot(plot_df, aes(x = YEAR, y = prop, fill = YEAR)) +
geom_col(width = 0.5, show.legend = FALSE) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.15, linewidth = 0.8) +
geom_text(aes(label = ifelse(YEAR %in% c(2006, 2024), paste0("n=", n, "\nx=", x), NA)),
vjust = -0.9, size = 3.5) +
scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
labs(
title = "Proportion of Lightning-caused Wildfires (AC 95% CI)",
x = "Year",
y = "Proportion (Lightning)"
) +
theme_minimal(base_size = 12)
knitr::opts_chunk$set(echo = TRUE)
### Hey guys, lets use APA citation again. save any references in a bib
#in-text citation is [@key] for example [@alberta_wildfire_dataset]
#put imported libraries here
library(tidyverse)
library(mosaic)
#read in wildfire csv file
url <- "https://raw.githubusercontent.com/JohannaEnright/Wildfire_602_Project/refs/heads/main/fp-historical-wildfire-data-2006-2024.csv"
df = read_csv(url, show_col_types = F)
####### determining proportion for lightning caused fires in 2006 and 2024  #######
#2006
df_2006 <- df %>%  filter(YEAR == 2006)
n_2006 <- nrow(df_2006)
x_2006 <- df_2006 %>% filter(GENERAL_CAUSE == "Lightning") %>% nrow()  #number from 2006 caused by lightning
p_lightning_2006 <- x_2006/n_2006
#2024
df_2024 <- df %>%  filter(YEAR == 2024)
n_2024 <- nrow(df_2024)
x_2024 <- df_2024 %>% filter(GENERAL_CAUSE == "Lightning") %>% nrow() #x is number of fires caused by lightning
p_lightning_2024 <- x_2024/n_2024
print(paste("The 2006 proportion is", round(p_lightning_2006,4) ," and the 2024 proportion is", round(p_lightning_2024,4)))
## confirming it follows assumtions (np > 10) , (nq > 10)   # is sufficiently large.
n_2006*p_lightning_2006 >10 ; n_2006*(1 - p_lightning_2006) > 10 ## greater than 10
n_2024*p_lightning_2024 > 10 ; n_2024*(1 - p_lightning_2024) > 10
#############################  CALCULATING Z-observed ####################################
# Zobs = ((phat1 - phat2) - (p1 - p2)) / sqrt(phat*(1-phat)*(1/n1 + 1/n2))
phat <- (x_2006 + x_2024)/(n_2006 + n_2024)
p1_min_p2 <- 0   #under the assumption of the null hypothesis
Zobs <- ((p_lightning_2024 - p_lightning_2006) - p1_min_p2)/sqrt(phat*(1-phat)*(1/n_2024 + 1/n_2006))
pvalue <- round(1 - pnorm(Zobs),5)
print(paste("The test statistic is:", round(Zobs,4), "The p-value is:", pvalue))
#set up dataframe
x <- seq(-5, 5,0.001)
df_norm <- tibble(x = x, y = dnorm(x, mean = 0, sd = 1))
#labels for lines
labels_df <- tibble(x = c(qnorm(0.95), Zobs), y = 0.21,
label = c(bquote(Z[0.05] == .(round(qnorm(0.95),2))), bquote(Z["obs"] == .(round(Zobs,2)))) )
p <- df_norm %>%
ggplot(aes(x = x, y = y)) +
geom_line(linewidth = 1)+
geom_segment(aes(x = qnorm(0.95), xend = qnorm(0.95), y = 0, yend = 0.2),
linewidth = 1, color = "black") +
geom_segment(aes(x = Zobs, xend = Zobs, y = 0, yend = 0.2),
linewidth = 1, color = "black") +
geom_text(data = labels_df, aes(x = x, y = y, label = label), vjust = 0, hjust = 0, color = "black", parse=TRUE) +
#shade in areas
geom_area(data = subset(df_norm, x > qnorm(0.95)), aes(x = x, y = y), fill = "red", alpha = 0.3) +   # shade passed critical value
geom_area(data = subset(df_norm, x > Zobs), aes(x = x, y = y), fill = "blue", alpha = 1) +     #shade passed Zobs
annotate(geom = "text", x = 5, y = 0.02, label = paste("p=", pvalue), size = 3, hjust = 1) +
ggtitle(bquote("Right-Tailed Test for Lightning-Caused Wildfire Proportions H"[A] * ": p"[2024] > "p"[2006]),
subtitle = "Standard Normal Curve") +
theme_minimal()
print(p)
################## USING THE AGRESTI-COULL (+1/+2 METHOD) 95% CI ################################
# (ptilde1 - ptilde2) +/-  (z (1 - alpha/2)) * sqrt((ptilde1*qtilde1/(n1 + 2)) + (ptilde2*qtilde2)/(n2 + 2))
#p_tilde = (x + 1)/ (n + 2)
p_tilde_2024 <- (x_2024 + 1)/(n_2024 + 2)
p_tilde_2006 <- (x_2006 + 1)/(n_2006 + 2)
ptilde_diff <- p_tilde_2024 - p_tilde_2006
z <- qnorm(1 - 0.05/2)
SE <- sqrt(((p_tilde_2024)*(1-p_tilde_2024)/(n_2024 + 2)) +
((p_tilde_2006)*(1-p_tilde_2006)/(n_2006 + 2))
)
lb <- ptilde_diff - z * SE
ub <- ptilde_diff + z * SE
paste(round(lb, 4), "-", round(ub, 4))
# CONCLUSION : 2024 HAS A SIGNIFICANTLY HIGHER PROPORITON OF LIGHTNING-CAUSED WILDFIRES THAT 2006
# Visualization
plot_df <- tibble(
YEAR  = factor(c(2006, 2024, "Difference")),
prop  = c(p_lightning_2006, p_lightning_2024, p_lightning_2024-p_lightning_2006),
lower = c(NA, NA, lb),
upper = c(NA, NA, ub),
n     = c(n_2006, n_2024, NA),
x     = c(x_2006, x_2024, NA)
)
ggplot(plot_df, aes(x = YEAR, y = prop, fill = YEAR)) +
geom_col(width = 0.5, show.legend = FALSE) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.15, linewidth = 0.8) +
geom_text(aes(label = ifelse(YEAR %in% c(2006, 2024), paste0("n=", n, "\nx=", x), NA)),
vjust = -0.9, size = 3.5) +
scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
labs(
title = "Proportion of Lightning-caused Wildfires (AC 95% CI)",
x = "Year",
y = "Proportion (Lightning)"
) +
theme_minimal(base_size = 12)
